<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Curso en Línea</title>
  <!-- Link to the Tailwind CSS library for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Link to Font Awesome for course icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f0f4f8;
    }
    @keyframes fade-in-down {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes fade-in-up {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes fade-in {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    .animate-fade-in-down {
      animation: fade-in-down 0.5s ease-out;
    }
    .animate-fade-in-up {
      animation: fade-in-up 0.5s ease-out;
    }
    .animate-fade-in {
      animation: fade-in 0.5s ease-out;
    }
    /* Payment modal styles */
    .payment-modal, .alert-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .certificate-container {
      background-image: url('https://placehold.co/1000x700/D4F5E6/0C2719?text=Certificado');
      background-size: cover;
      background-position: center;
    }
    .diploma-container {
      background-image: url('https://placehold.co/1000x700/EFEFEF/333333?text=Diploma');
      background-size: cover;
      background-position: center;
    }
    /* Chatbot styles */
    .chatbot-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 900;
      width: 320px;
      height: 400px;
      background-color: #ffffff;
      border-radius: 1rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      transform: scale(0);
      transition: transform 0.3s ease-out;
      transform-origin: bottom right;
    }
    .chatbot-container.active {
      transform: scale(1);
    }
    .chatbot-header {
      background-color: #3b82f6;
      color: white;
      padding: 1rem;
      border-radius: 1rem 1rem 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chatbot-body {
      flex-grow: 1;
      padding: 1rem;
      overflow-y: auto;
      background-color: #f3f4f6;
    }
    .chatbot-input {
      padding: 1rem;
      background-color: #e5e7eb;
      border-radius: 0 0 1rem 1rem;
    }
    .message-bubble {
      max-width: 80%;
      padding: 0.5rem 1rem;
      border-radius: 1rem;
      margin-bottom: 0.5rem;
    }
    .user-message {
      background-color: #3b82f6;
      color: white;
      align-self: flex-end;
      margin-left: auto;
    }
    .bot-message {
      background-color: #d1d5db;
      color: black;
      align-self: flex-start;
      margin-right: auto;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Header of the page -->
  <header class="bg-blue-800 text-white p-4 shadow-lg">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-3xl font-bold">Mi Curso en Línea</h1>
      <nav class="space-x-6 flex items-center">
        <a href="#" onclick="cargarPagina('inicio')" class="hover:text-blue-200 transition-colors duration-200">Inicio</a>
        
        <!-- Courses link (no dropdown) -->
        <a href="#" onclick="cargarCursosPorTipo('todos')" class="hover:text-blue-200 transition-colors duration-200">
          Cursos
        </a>

        <a href="#" onclick="checkAndLoadVirtualClassroom()" class="hover:text-blue-200 transition-colors duration-200">Aula Virtual</a>
        <a href="#" onclick="checkAuthState()" class="hover:text-blue-200 transition-colors duration-200">Certificados</a>
        <a href="#" onclick="cargarPagina('contacto')" class="hover:text-blue-200 transition-colors duration-200">Contacto</a>
      </nav>
    </div>
  </header>

  <main id="contenido" class="flex-grow container mx-auto p-8">
    <!-- Page content will be loaded here dynamically -->
  </main>

  <!-- Payment modal (hidden by default) -->
  <div id="payment-modal" class="payment-modal hidden">
    <div class="bg-white p-8 rounded-2xl shadow-xl w-11/12 md:w-1/2 lg:w-1/3 animate-fade-in">
      <h3 id="payment-course-title" class="text-2xl font-bold text-gray-800 mb-4">Pago de curso</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-gray-700 font-medium mb-1">Número de tarjeta</label>
          <input type="text" id="card-number" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="XXXX XXXX XXXX XXXX">
        </div>
        <div class="flex space-x-4">
          <div class="w-1/2">
            <label class="block text-gray-700 font-medium mb-1">Fecha de expiración</label>
            <input type="text" id="card-expiry" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="MM/AA">
          </div>
          <div class="w-1/2">
            <label class="block text-gray-700 font-medium mb-1">CVC</label>
            <input type="text" id="card-cvc" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="XXX">
          </div>
        </div>
        <button id="confirm-payment-button" onclick="confirmarPago()" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-full hover:bg-blue-700 transition-colors duration-300 transform hover:scale-105">
          Confirmar pago
        </button>
      </div>
      <button onclick="cerrarPago()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800">
        <i class="fas fa-times text-2xl"></i>
      </button>
    </div>
  </div>
  
  <!-- Footer -->
  <footer class="bg-gray-800 text-gray-400 p-4 text-center mt-8">
    <p>&copy; 2025 Mi Curso en Línea - Todos los derechos reservados.</p>
  </footer>

  <script>
    // Global variable to simulate authentication status
    let isLoggedIn = false;
    let userId = null;
    let tempCourseData = null; // Temporary variable to hold course registration data

    // Mock user database
    // This structure now includes enrolledCourses and completedCourses
    let mockUsers = {
        'user-001': { email: 'user001@example.com', password: 'password123', name: 'Usuario Prueba', enrolledCourses: ['java', 'automotrices'], completedCourses: [] }
    };

    // Course data structure
    const cursosData = [
      {
        id: 'java',
        title: 'Java Avanzado',
        icon: 'fab fa-java',
        description: 'Profundiza en programación Java, POO, hilos y proyectos completos.',
        duration: '8 semanas',
        modality: 'Virtual',
        color: 'bg-blue-600',
        ringColor: 'focus:ring-blue-500',
        buttonColor: 'text-blue-600',
        type: 'programacion'
      },
      {
        id: 'python',
        title: 'Python Avanzado',
        icon: 'fab fa-python',
        description: 'Aprende Python avanzado, ciencia de datos y automatización de procesos.',
        duration: '8 semanas',
        modality: 'Virtual',
        color: 'bg-green-600',
        ringColor: 'focus:ring-green-500',
        buttonColor: 'text-green-600',
        type: 'programacion'
      },
      {
        id: 'machine-learning',
        title: 'Machine Learning',
        icon: 'fas fa-brain',
        description: 'Fundamentos, algoritmos y proyectos prácticos de inteligencia artificial.',
        duration: '10 semanas',
        modality: 'Virtual',
        color: 'bg-purple-600',
        ringColor: 'focus:ring-purple-500',
        buttonColor: 'text-purple-600',
        type: 'programacion'
      },
      {
        id: 'nanorecubrimientos',
        title: 'Nanorrecubrimientos Avanzados',
        icon: 'fas fa-microscope',
        description: 'Explora la ciencia y aplicación de recubrimientos a nivel nanométrico.',
        duration: '12 semanas',
        modality: 'Virtual',
        color: 'bg-red-600',
        ringColor: 'focus:ring-red-500',
        buttonColor: 'text-red-600',
        type: 'recubrimientos'
      },
      {
        id: 'automotrices',
        title: 'Recubrimientos Automotrices',
        icon: 'fas fa-car',
        description: 'Técnicas de pintura y protección para la industria automotriz.',
        duration: '9 semanas',
        modality: 'Virtual',
        color: 'bg-indigo-600',
        ringColor: 'focus:ring-indigo-500',
        buttonColor: 'text-indigo-600',
        type: 'recubrimientos'
      },
      {
        id: 'industriales',
        title: 'Pinturas y Barnices Industriales',
        icon: 'fas fa-industry',
        description: 'Aprende sobre la formulación y uso de recubrimientos para entornos industriales.',
        duration: '10 semanas',
        modality: 'Virtual',
        color: 'bg-gray-800',
        ringColor: 'focus:ring-gray-600',
        buttonColor: 'text-gray-800',
        type: 'recubrimientos'
      },
      {
        id: 'anticorrosivos',
        title: 'Recubrimientos Anticorrosivos',
        icon: 'fas fa-shield-alt',
        description: 'Estrategias y materiales para la prevención de la corrosión.',
        duration: '8 semanas',
        modality: 'Virtual',
        color: 'bg-yellow-600',
        ringColor: 'focus:ring-yellow-500',
        buttonColor: 'text-yellow-600',
        type: 'recubrimientos'
      },
      {
        id: 'esmaltes',
        title: 'Esmaltes Cerámicos y Vidriados',
        icon: 'fas fa-palette',
        description: 'Proceso de creación y aplicación de esmaltes y vidriados.',
        duration: '7 semanas',
        modality: 'Virtual',
        color: 'bg-pink-600',
        ringColor: 'focus:ring-pink-500',
        buttonColor: 'text-pink-600',
        type: 'recubrimientos'
      },
      {
        id: 'polvo',
        title: 'Recubrimientos de Polvo',
        icon: 'fas fa-spray-can',
        description: 'Fundamentos y técnicas de aplicación de la pintura en polvo.',
        duration: '6 semanas',
        modality: 'Virtual',
        color: 'bg-teal-600',
        ringColor: 'focus:ring-teal-500',
        buttonColor: 'text-teal-600',
        type: 'recubrimientos'
      },
      {
        id: 'sostenibles',
        title: 'Recubrimientos Sostenibles',
        icon: 'fas fa-leaf',
        description: 'Innovaciones en recubrimientos ecológicos y de bajo impacto ambiental.',
        duration: '11 semanas',
        modality: 'Virtual',
        color: 'bg-lime-600',
        ringColor: 'focus:ring-lime-500',
        buttonColor: 'text-lime-600',
        type: 'recubrimientos'
      },
      {
        id: 'pulido',
        title: 'Técnicas de Pulido y Acabado',
        icon: 'fas fa-star',
        description: 'Mejora tus habilidades en pulido y obtención de acabados de alta calidad.',
        duration: '5 semanas',
        modality: 'Virtual',
        color: 'bg-cyan-600',
        ringColor: 'focus:ring-cyan-500',
        buttonColor: 'text-cyan-600',
        type: 'recubrimientos'
      },
      {
        id: 'madera',
        title: 'Recubrimientos para Madera',
        icon: 'fas fa-tree',
        description: 'Tipos y aplicaciones de barnices y selladores para madera.',
        duration: '6 semanas',
        modality: 'Virtual',
        color: 'bg-amber-600',
        ringColor: 'focus:ring-amber-500',
        buttonColor: 'text-amber-600',
        type: 'recubrimientos'
      },
      {
        id: 'construccion',
        title: 'Recubrimientos para Construcción',
        icon: 'fas fa-hard-hat',
        description: 'Soluciones de recubrimiento para fachadas, pisos y estructuras.',
        duration: '9 semanas',
        modality: 'Virtual',
        color: 'bg-emerald-600',
        ringColor: 'focus:ring-emerald-500',
        buttonColor: 'text-emerald-600',
        type: 'recubrimientos'
      },
      {
        id: 'marinos',
        title: 'Recubrimientos Marinos',
        icon: 'fas fa-ship',
        description: 'Sistemas de recubrimiento para embarcaciones y estructuras oceánicas.',
        duration: '10 semanas',
        modality: 'Virtual',
        color: 'bg-sky-600',
        ringColor: 'focus:ring-sky-500',
        buttonColor: 'text-sky-600',
        type: 'recubrimientos'
      },
      {
        id: 'alimentarios',
        title: 'Recubrimientos Alimentarios',
        icon: 'fas fa-utensils',
        description: 'Regulaciones y técnicas de aplicación en la industria alimentaria.',
        duration: '7 semanas',
        modality: 'Virtual',
        color: 'bg-orange-600',
        ringColor: 'focus:ring-orange-500',
        buttonColor: 'text-orange-600',
        type: 'recubrimientos'
      },
      {
        id: 'sanitario',
        title: 'Recubrimientos para el Sector Sanitario',
        icon: 'fas fa-hospital',
        description: 'Materiales y técnicas para superficies higiénicas en hospitales y clínicas.',
        duration: '8 semanas',
        modality: 'Virtual',
        color: 'bg-gray-600',
        ringColor: 'focus:ring-gray-500',
        buttonColor: 'text-gray-600',
        type: 'recubrimientos'
      },
      {
        id: 'aeroespacial',
        title: 'Recubrimientos para la Industria Aeroespacial',
        icon: 'fas fa-rocket',
        description: 'Materiales de alta tecnología para aeronaves y naves espaciales.',
        duration: '15 semanas',
        modality: 'Virtual',
        color: 'bg-blue-900',
        ringColor: 'focus:ring-blue-800',
        buttonColor: 'text-blue-900',
        type: 'recubrimientos'
      },
    ];

    // Functions to dynamically load page content
    function cargarPagina(nombrePagina) {
        const contenido = document.getElementById('contenido');
        contenido.innerHTML = paginas[nombrePagina];
        // Ensure the chatbot button is visible for pages with a chatbot
        const chatbotButton = document.getElementById('chatbot-button');
        if (nombrePagina === 'certificados' || nombrePagina === 'contacto') {
            chatbotButton.classList.remove('hidden');
        } else {
            chatbotButton.classList.add('hidden');
            document.getElementById('chatbot-container').classList.remove('active');
        }

        if (nombrePagina === 'certificados') {
            // Populate the course dropdown dynamically
            populateCertificateCourseDropdown();
            
            const userIdText = document.getElementById('user-id-text');
            if (userIdText) {
                userIdText.textContent = userId;
            }
        }
    }
    
    // Function to load courses based on type (or all)
    function cargarCursosPorTipo(tipo = 'todos') {
        const contenido = document.getElementById('contenido');
        const cursosFiltrados = tipo === 'todos' ? cursosData : cursosData.filter(curso => curso.type === tipo);
        
        // Hide chatbot button when viewing courses
        document.getElementById('chatbot-button').classList.add('hidden');
        document.getElementById('chatbot-container').classList.remove('active');

        let cursosHTML = `<h2 class="text-4xl font-extrabold text-gray-800 mb-8 text-center animate-fade-in-up">Nuestros Cursos Disponibles</h2><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">`;
        cursosFiltrados.forEach(curso => {
            cursosHTML += `
                <div class="${curso.color} p-8 rounded-2xl shadow-lg hover:shadow-xl transform hover:scale-105 text-white transition duration-300 animate-fade-in">
                    <i class="${curso.icon} text-4xl mb-4 opacity-75"></i>
                    <h3 class="text-2xl font-bold mb-2">${curso.title}</h3>
                    <p class="text-sm opacity-90 mb-4">${curso.description}</p>
                    <p class="text-sm font-medium mb-1">Duración: ${curso.duration}</p>
                    <p class="text-sm font-medium mb-4">Modalidad: ${curso.modality}</p>
                    
                    <button onclick="mostrarFormulario('form-${curso.id}')" class="bg-white ${curso.buttonColor} font-semibold py-2 px-6 rounded-full shadow-md hover:bg-gray-100 transition-colors duration-300">
                      Registrarme
                    </button>

                    <!-- Registration form (hidden by default) -->
                    <form id="form-${curso.id}" class="hidden mt-6 bg-white text-gray-900 p-6 rounded-xl shadow-md space-y-4" onsubmit="procesarRegistro(event, '${curso.id}')">
                      <h4 class="text-xl font-bold">Registro: ${curso.title}</h4>
                      <div>
                        <label class="block mb-1 font-medium text-sm">Nombre completo</label>
                        <input type="text" name="nombre" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 ${curso.ringColor}" required>
                      </div>
                      <div>
                        <label class="block mb-1 font-medium text-sm">Correo electrónico</label>
                        <input type="email" name="email" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 ${curso.ringColor}" required>
                      </div>
                      <input type="hidden" name="curso" value="${curso.title}">
                      <button type="submit" class="w-full ${curso.color} text-white font-semibold py-2 px-4 rounded-lg hover:${curso.color.replace('600', '700')} transition-colors duration-300">
                        Enviar registro y pagar
                      </button>
                    </form>
                </div>
            `;
        });
        cursosHTML += `</div>`;
        contenido.innerHTML = cursosHTML;
    }

    // Object to store page content
    const paginas = {
      'inicio': `
        <div class="text-center py-20">
          <h2 class="text-5xl font-extrabold text-gray-800 mb-4 animate-fade-in-down">¡Bienvenido a Mi Curso en Línea!</h2>
          <p class="text-lg text-gray-600 mb-8 animate-fade-in">Aprende nuevas habilidades y alcanza tus metas profesionales.</p>
          <a href="#" onclick="cargarCursosPorTipo('todos')" class="bg-blue-600 text-white font-semibold py-3 px-8 rounded-full shadow-lg hover:bg-blue-700 transform hover:scale-105 transition-all duration-300">
            Explora nuestros cursos
          </a>
        </div>
      `,
      'cursos': '', // This page is now loaded dynamically by cargarCursosPorTipo
      'aula-virtual': `
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full mx-auto animate-fade-in-down">
          <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Mi Aula Virtual</h2>
          <div id="enrolled-courses-list" class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <p class="text-center text-gray-500 col-span-full">No estás inscrito en ningún curso. ¡Explora nuestros cursos para comenzar!</p>
          </div>
        </div>
      `,
      'certificados': `
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl mx-auto animate-fade-in-down">
          <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Generar Certificado o Diploma</h2>
          <div id="user-info-display" class="bg-gray-100 p-4 rounded-lg mb-6 text-center">
            <span class="text-gray-600">ID de Usuario:</span> <span id="user-id-text" class="font-mono font-bold text-sm text-gray-800">Cargando...</span>
          </div>
          <form id="certificate-form" class="space-y-6" onsubmit="generarDocumento(event)">
            <div>
              <label for="student-name" class="block text-gray-700 font-medium mb-2">Nombre del Estudiante</label>
              <input type="text" id="student-name" name="student-name" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej. Juan Pérez" required>
            </div>
            <div>
              <label for="course-name" class="block text-gray-700 font-medium mb-2">Selecciona el Curso</label>
              <select id="course-name" name="course-name" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <!-- Course options will be dynamically inserted here by JavaScript -->
                <option value="">-- Elige un curso --</option>
              </select>
            </div>
            <div>
              <label for="final-grade" class="block text-gray-700 font-medium mb-2">Nota Final (0-100)</label>
              <input type="number" id="final-grade" name="final-grade" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" max="100" required>
            </div>
            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-300 transform hover:scale-105">
              Generar Documento
            </button>
          </form>
          <div id="document-output" class="mt-8 rounded-lg overflow-hidden border border-gray-300">
            <!-- The certificate or diploma will be displayed here -->
          </div>
        </div>
      `,
      'contacto': `
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-xl mx-auto animate-fade-in-up">
          <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Contáctanos</h2>
          <form id="contact-form" class="space-y-6">
            <div>
              <label for="contact-name" class="block text-gray-700 font-medium mb-2">Nombre Completo</label>
              <input type="text" id="contact-name" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            <div>
              <label for="contact-email" class="block text-gray-700 font-medium mb-2">Correo Electrónico</label>
              <input type="email" id="contact-email" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            <div>
              <label for="contact-message" class="block text-gray-700 font-medium mb-2">Tu Mensaje</label>
              <textarea id="contact-message" rows="5" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
            </div>
            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-300 transform hover:scale-105">
              Enviar Mensaje
            </button>
          </form>
        </div>
      `,
      'login': `
        <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-lg mx-auto animate-fade-in-down">
          <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Acceso a Aula</h2>
          <div class="space-y-6">
            <h3 class="text-2xl font-semibold text-gray-700">Iniciar Sesión</h3>
            <form id="login-form" class="space-y-4" onsubmit="handleLogin(event)">
              <div>
                <label for="login-email" class="block text-gray-700 font-medium mb-2">ID de Usuario</label>
                <input type="text" id="login-email" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required placeholder="Ej. user001@example.com">
              </div>
              <div>
                <label for="login-password" class="block text-gray-700 font-medium mb-2">Clave de Acceso</label>
                <input type="password" id="login-password" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
              </div>
              <button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-300">
                Acceder
              </button>
            </form>
          </div>
        </div>
      `
    };

    function mostrarModal(title, message) {
        const modal = document.createElement('div');
        modal.classList.add('alert-modal');
        modal.innerHTML = `
            <div class="bg-white p-8 rounded-2xl shadow-xl w-11/12 md:w-1/2 lg:w-1/3 animate-fade-in">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">${title}</h3>
                <p class="text-gray-700 mb-6">${message}</p>
                <button onclick="cerrarModal(this)" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-full hover:bg-blue-700 transition-colors duration-300 transform hover:scale-105">Cerrar</button>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    function cerrarModal(button) {
      const modal = button.closest('.alert-modal');
      if (modal) {
        modal.remove();
      }
    }


    function generarDocumento(event) {
      event.preventDefault();

      const studentName = document.getElementById('student-name').value;
      const courseName = document.getElementById('course-name').value;
      const finalGrade = parseInt(document.getElementById('final-grade').value);
      const documentOutput = document.getElementById('document-output');

      if (finalGrade >= 70) {
        // Generate approval certificate
        documentOutput.innerHTML = `
          <div class="certificate-container p-12 text-center text-gray-800">
            <h3 class="text-4xl font-extrabold mb-8">CERTIFICADO DE APROBACIÓN</h3>
            <p class="text-lg font-medium">Este documento certifica que</p>
            <p class="text-5xl font-bold my-4">${studentName}</p>
            <p class="text-lg font-medium">ha completado satisfactoriamente el curso de</p>
            <p class="text-3xl font-bold my-4">${courseName}</p>
            <p class="text-lg font-medium">con una nota final de</p>
            <p class="text-3xl font-bold mt-4">${finalGrade}/100</p>
            <p class="text-sm italic mt-8">Emitido el ${new Date().toLocaleDateString('es-ES')}</p>
          </div>
        `;
      } else {
        // Generate participation diploma
        documentOutput.innerHTML = `
          <div class="diploma-container p-12 text-center text-gray-800">
            <h3 class="text-4xl font-extrabold mb-8">DIPLOMA DE PARTICIPACIÓN</h3>
            <p class="text-lg font-medium">Este documento certifica que</p>
            <p class="text-5xl font-bold my-4">${studentName}</p>
            <p class="text-lg font-medium">ha participado en el curso de</p>
            <p class="text-3xl font-bold my-4">${courseName}</p>
            <p class="text-sm italic mt-8">Emitido el ${new Date().toLocaleDateString('es-ES')}</p>
          </div>
        `;
      }
    }

    function mostrarFormulario(formId) {
        // Hide all registration forms
        document.querySelectorAll('form[id^="form-"]').forEach(form => {
            form.classList.add('hidden');
        });
        // Show the selected course form
        const formToShow = document.getElementById(formId);
        if (formToShow) {
            formToShow.classList.remove('hidden');
        }
    }
    
    function procesarRegistro(event, cursoId) {
      event.preventDefault();
      const form = event.target;
      tempCourseData = {
          id: cursoId,
          title: form.querySelector('input[name="curso"]').value,
          studentName: form.querySelector('input[name="nombre"]').value,
          email: form.querySelector('input[name="email"]').value
      };
      document.getElementById('payment-modal').classList.remove('hidden');
      document.getElementById('payment-course-title').textContent = `Pago: ${tempCourseData.title}`;
    }

    function confirmarPago() {
      // Get data from the payment form
      const cardNumber = document.getElementById('card-number').value;
      const cardExpiry = document.getElementById('card-expiry').value;
      const cardCvc = document.getElementById('card-cvc').value;

      // Simple validation for mock purposes
      if (cardNumber && cardExpiry && cardCvc) {
        document.getElementById('payment-modal').classList.add('hidden');
        simularInscripcionYCrearUsuario();
      } else {
        mostrarModal('Error', 'Por favor, completa todos los campos de pago.');
      }
    }
    
    function cerrarPago() {
      document.getElementById('payment-modal').classList.add('hidden');
      tempCourseData = null; // Clear temp data on cancel
    }
    
    // Function to simulate user registration after payment
    function simularInscripcionYCrearUsuario() {
        const { id, title, studentName, email } = tempCourseData;
        const newUserId = 'user-' + Math.random().toString(36).substr(2, 9);
        const newPassword = Math.random().toString(36).substr(2, 8); // Simple random password
        
        // Add new user to mock database
        mockUsers[newUserId] = {
            email: email,
            password: newPassword,
            name: studentName,
            enrolledCourses: [id],
            completedCourses: []
        };
        
        // Log in the new user and save to localStorage
        isLoggedIn = true;
        userId = newUserId;
        localStorage.setItem('currentUser', JSON.stringify({ email: email, id: newUserId }));
        
        // Show success modal with credentials
        mostrarModal('Pago Exitoso y Cuenta Creada', 
            `¡Gracias por tu pago! Tu registro en el curso "${title}" ha sido completado. ` +
            `Se han generado tus credenciales y se enviaron a tu correo: <br><br>` +
            `<b>ID de Usuario:</b> ${email}<br>` +
            `<b>Clave de Acceso:</b> ${newPassword}<br><br>` +
            `Ahora puedes acceder al aula virtual.`
        );

        // Redirect to virtual classroom after a short delay
        setTimeout(() => {
            checkAndLoadVirtualClassroom();
        }, 2000);
    }

    function handleLogin(event) {
        event.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        
        // Find user by email
        const userKeys = Object.keys(mockUsers);
        const foundUserKey = userKeys.find(key => mockUsers[key].email === email);
        const user = mockUsers[foundUserKey];

        if (user && user.password === password) {
            isLoggedIn = true;
            userId = foundUserKey;
            localStorage.setItem('currentUser', JSON.stringify({ email: email, id: foundUserKey }));
            mostrarModal('Éxito', '¡Has iniciado sesión correctamente!');
            checkAndLoadVirtualClassroom(); // Redirect to virtual classroom after login
        } else {
            mostrarModal('Error', 'ID de Usuario o clave de acceso incorrectos.');
        }
    }
    
    function checkAuthState() {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (currentUser && mockUsers[currentUser.id]) {
            isLoggedIn = true;
            userId = currentUser.id;
            cargarPagina('certificados');
        } else {
            isLoggedIn = false;
            userId = null;
            cargarPagina('login');
        }
    }
    
    function checkAndLoadVirtualClassroom() {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (currentUser && mockUsers[currentUser.id]) {
            isLoggedIn = true;
            userId = currentUser.id;
            cargarPagina('aula-virtual');
            cargarCursosDelUsuario();
        } else {
            isLoggedIn = false;
            userId = null;
            cargarPagina('login');
        }
    }
    
    // Function to load the user's courses in the virtual classroom
    function cargarCursosDelUsuario() {
        const enrolledList = document.getElementById('enrolled-courses-list');
        const user = mockUsers[userId];
        
        if (!enrolledList) return; // Exit if the element is not on the page
        
        if (!user || (!user.enrolledCourses.length && !user.completedCourses.length)) {
            enrolledList.innerHTML = `<p class="text-center text-gray-500 col-span-full">No estás inscrito en ningún curso. ¡Explora nuestros cursos para comenzar!</p>`;
            return;
        }

        enrolledList.innerHTML = ''; // Clear previous content

        // Courses in progress
        user.enrolledCourses.forEach(cursoId => {
            const curso = cursosData.find(c => c.id === cursoId);
            if (curso) {
                enrolledList.innerHTML += `
                    <div class="bg-gray-100 p-6 rounded-xl shadow-md">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Curso: ${curso.title}</h3>
                        <p class="text-sm text-gray-700">Progreso: <span class="font-bold">En curso</span></p>
                        <div class="mt-4 flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4">
                            <button onclick="mostrarModal('Lección', '¡Aquí iría el contenido del curso!')" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-full hover:bg-blue-700 transition-colors duration-300">
                                Continuar Curso
                            </button>
                            <button onclick="marcarCursoComoCompletado('${curso.id}')" class="bg-green-600 text-white font-bold py-2 px-4 rounded-full hover:bg-green-700 transition-colors duration-300">
                                Marcar como Completado
                            </button>
                        </div>
                    </div>
                `;
            }
        });

        // Completed courses
        if (user.completedCourses.length > 0) {
            enrolledList.innerHTML += `<div class="col-span-full mt-8"><h3 class="text-2xl font-bold text-gray-800 mb-4">Cursos Completados</h3></div>`;
            user.completedCourses.forEach(cursoId => {
                const curso = cursosData.find(c => c.id === cursoId);
                if (curso) {
                    enrolledList.innerHTML += `
                        <div class="bg-gray-100 p-6 rounded-xl shadow-md">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">Curso: ${curso.title}</h3>
                            <p class="text-sm text-gray-700">Progreso: <span class="font-bold text-green-600">Completado</span></p>
                            <div class="mt-4">
                                <button onclick="cargarPaginaYGenerarCertificado('${curso.id}')" class="bg-purple-600 text-white font-bold py-2 px-4 rounded-full hover:bg-purple-700 transition-colors duration-300">
                                    Generar Certificado
                                </button>
                            </div>
                        </div>
                    `;
                }
            });
        }
    }
    
    // Marks a course as completed for the current user
    function marcarCursoComoCompletado(cursoId) {
        const user = mockUsers[userId];
        if (user) {
            const courseIndex = user.enrolledCourses.indexOf(cursoId);
            if (courseIndex > -1) {
                user.enrolledCourses.splice(courseIndex, 1);
                user.completedCourses.push(cursoId);
                localStorage.setItem('currentUser', JSON.stringify({ email: user.email, id: userId }));
                mostrarModal('¡Curso Completado!', '¡Felicidades! Has completado el curso. Ahora puedes generar tu certificado.');
                cargarCursosDelUsuario(); // Refresh the list
            }
        }
    }

    // Redirects to certificate page and pre-fills form
    function cargarPaginaYGenerarCertificado(cursoId) {
        const curso = cursosData.find(c => c.id === cursoId);
        if (curso) {
            cargarPagina('certificados');
            setTimeout(() => {
                document.getElementById('student-name').value = mockUsers[userId].name;
                document.getElementById('course-name').value = curso.title;
                document.getElementById('final-grade').value = 95; // Mock a high grade
            }, 50);
        }
    }
    
    // Function to populate the course dropdown on the certificate form
    function populateCertificateCourseDropdown() {
      const selectElement = document.getElementById('course-name');
      if (selectElement) {
        // Clear existing options except the first one
        selectElement.innerHTML = `<option value="">-- Elige un curso --</option>`;
        cursosData.forEach(curso => {
          const option = document.createElement('option');
          option.value = curso.title;
          option.textContent = curso.title;
          selectElement.appendChild(option);
        });
      }
    }

    // Initial app load
    window.onload = function() {
        cargarPagina('inicio');
    };
  </script>

  <!-- Chatbot button -->
  <button id="chatbot-button" class="fixed bottom-8 right-8 bg-blue-600 text-white rounded-full p-4 shadow-lg hover:bg-blue-700 transition-colors duration-300 hidden" onclick="toggleChatbot()">
    <i class="fas fa-comment-dots text-3xl"></i>
  </button>

  <!-- Chatbot container (hidden by default) -->
  <div id="chatbot-container" class="chatbot-container">
    <div class="chatbot-header">
      <h4 class="text-xl font-bold">Asistente Virtual</h4>
      <button onclick="toggleChatbot()" class="text-white hover:text-blue-200">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="chat-body" class="chatbot-body flex flex-col space-y-2">
      <div class="message-bubble bot-message">
        Hola, ¿en qué puedo ayudarte hoy?
      </div>
    </div>
    <div class="chatbot-input flex items-center space-x-2">
      <input type="text" id="chat-input" class="w-full p-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Escribe tu mensaje...">
      <button onclick="enviarMensaje()" class="bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition-colors duration-300">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

</body>
</h
